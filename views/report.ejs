<!DOCTYPE html>
<html>
<head>
  <title>Report Page</title>
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>
</head>
<body>
  <h1>Report Page</h1>
  <div x-data="{
    data: [],
    fetchData() {
      console.log('Fetching data');
      fetch('/api/user')
        .then(response => response.json())
        .then(result => {
          console.log(result);
          this.data = result.data;
        })
        .catch(error => {
          console.error('Error:', error);
        });
    },
    deleteUser(userId) {
      fetch(`/api/user/${userId}`, {
        method: 'DELETE'
      })
        .then(response => {
          if (response.ok) {
            // Remove the deleted user from the data array
            this.data = this.data.filter(user => user._id !== userId);
          } else {
            console.error('Error deleting user');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }
  }" x-init="fetchData()">
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Password</th>
          <th>Role</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="item in data">
          <tr>
            <td x-text="item.username"></td>
            <td x-text="item.password"></td>
            <td x-text="item.role"></td>
            <td><button @click="deleteUser(item._id)">DEL</button></td>
          </tr>
        </template>
      </tbody>
    </table>
    <button onclick="history.back()">Back</button>
  </div>
</body>
</html>
